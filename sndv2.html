<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Microphone Array Data Visualizer</title>
    <style>
        body {
            margin: 0;
            background: black;
            color: white;
            font-family: Arial, sans-serif;
        }
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .controls {
            height: 10%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            background: #222;
        }
        .controls button, .controls select {
            padding: 6px 12px;
            margin-right: 10px;
            background: #444;
            color: white;
            border: none;
            cursor: pointer;
        }
        .main-content {
            display: flex;
            flex: 1;
        }
        .table-container {
            width: 50%;
            height: 100%;
            overflow-y: auto;
            background: #111;
            padding: 10px;
        }
        .table-container ul {
            list-style: none;
            padding-left: 20px;
        }
        .visualizer-container {
            width: 50%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas {
            border: 1px solid white;
            width: 90%;
            height: 90%;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <div>
                <button onclick="startStream()">Start</button>
                <button onclick="pauseStream()">Pause</button>
                <button onclick="stopStream()">Stop</button>
                <button onclick="downloadData()">Download</button>
            </div>
            <div>
                <label for="vizSelect">Visualization:</label>
                <select id="vizSelect" onchange="changeViz(this.value)">
                    <option value="1">VIZ1</option>
                    <option value="2">VIZ2</option>
                    <option value="3">VIZ3</option>
                    <option value="4">VIZ4</option>
                    <option value="5">VIZ5</option>
                    <option value="6">VIZ6</option>
                    <option value="7">VIZ7</option>
                    <option value="8">VIZ8</option>
                    <option value="9">VIZ9</option>
                    <option value="10">VIZ10</option>
                </select>
            </div>
        </div>
        <div class="main-content">
            <div class="table-container" id="madTable">
                <!-- Dynamic collapsible table inserted here -->
            </div>
            <div class="visualizer-container">
                <canvas id="micVisualizer"></canvas>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('micVisualizer');
        const ctx = canvas.getContext('2d');
        const vizSelect = document.getElementById('vizSelect');
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const analyser = audioCtx.createAnalyser();
        analyser.fftSize = 2048;
        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);
        let streamSource;
        let currentViz = 1;
        let animFrame;

        async function startStream() {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            streamSource = audioCtx.createMediaStreamSource(stream);
            streamSource.connect(analyser);
            draw();
        }

        function pauseStream() {
            cancelAnimationFrame(animFrame);
        }

        function stopStream() {
            pauseStream();
            streamSource.disconnect();
        }

        function downloadData() {
            const blob = new Blob([dataArray], { type: 'application/octet-stream' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'mad_data.bin';
            a.click();
        }

        function changeViz(v) {
            currentViz = parseInt(v);
        }

        function draw() {
            animFrame = requestAnimationFrame(draw);
            analyser.getByteFrequencyData(dataArray);

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            switch (currentViz) {
                case 1: drawVIZ1(); break;
                case 2: drawVIZ2(); break;
                case 3: drawVIZ3(); break;
                case 4: drawVIZ4(); break;
                case 5: drawVIZ5(); break;
                case 6: drawVIZ6(); break;
                case 7: drawVIZ7(); break;
                case 8: drawVIZ8(); break;
                case 9: drawVIZ9(); break;
                case 10: drawVIZ10(); break;
            }
        }

        // VIZ1: Bar Graph
        function drawVIZ1() {
            const barWidth = (canvas.width / bufferLength) * 2.5;
            let barHeight;
            let x = 0;
            for (let i = 0; i < bufferLength; i++) {
                barHeight = dataArray[i] / 2;
                ctx.fillStyle = `rgb(${barHeight + 100}, 50, 50)`;
                ctx.fillRect(x, canvas.height - barHeight / 2, barWidth, barHeight / 2);
                x += barWidth + 1;
            }
        }

        // VIZ2â€“10: Placeholder examples (to be expanded with real visualizations)
        function drawVIZ2() {
            ctx.beginPath();
            for (let i = 0; i < bufferLength; i++) {
                const value = dataArray[i];
                ctx.lineTo(i * canvas.width / bufferLength, canvas.height - value);
            }
            ctx.strokeStyle = 'cyan';
            ctx.stroke();
        }
        function drawVIZ3() {
            for (let i = 0; i < bufferLength; i++) {
                ctx.beginPath();
                const radius = dataArray[i] / 5;
                ctx.arc(canvas.width / 2, canvas.height / 2, radius, 0, 2 * Math.PI);
                ctx.strokeStyle = `hsl(${i * 3.6}, 100%, 50%)`;
                ctx.stroke();
            }
        }
        function drawVIZ4() {
            for (let i = 0; i < bufferLength; i++) {
                const y = Math.random() * canvas.height;
                ctx.fillStyle = `rgba(255, ${dataArray[i]}, ${dataArray[bufferLength - i]}, 0.5)`;
                ctx.fillRect(i * 2, y, 2, 10);
            }
        }
        function drawVIZ5() {
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < bufferLength; i += 4) {
                const angle = (i / bufferLength) * 2 * Math.PI;
                const radius = dataArray[i];
                const x = canvas.width / 2 + radius * Math.cos(angle);
                const y = canvas.height / 2 + radius * Math.sin(angle);
                ctx.fillStyle = `hsl(${angle * 180 / Math.PI}, 100%, 50%)`;
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, 2 * Math.PI);
                ctx.fill();
            }
        }
        function drawVIZ6() {
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
            gradient.addColorStop(0, "red");
            gradient.addColorStop(1, "blue");
            ctx.fillStyle = gradient;
            for (let i = 0; i < bufferLength; i++) {
                ctx.fillRect(i * 2, canvas.height - dataArray[i], 2, dataArray[i]);
            }
        }
        function drawVIZ7() {
            ctx.font = "14px monospace";
            ctx.fillStyle = "lime";
            for (let i = 0; i < 20; i++) {
                ctx.fillText(dataArray[i], 10, 20 * (i + 1));
            }
        }
        function drawVIZ8() {
            const imgData = ctx.createImageData(canvas.width, canvas.height);
            for (let i = 0; i < imgData.data.length; i += 4) {
                imgData.data[i] = dataArray[(i / 4) % bufferLength]; // R
                imgData.data[i + 1] = 0; // G
                imgData.data[i + 2] = 255 - dataArray[(i / 4) % bufferLength]; // B
                imgData.data[i + 3] = 255;
            }
            ctx.putImageData(imgData, 0, 0);
        }
        function drawVIZ9() {
            ctx.strokeStyle = "white";
            ctx.beginPath();
            for (let i = 0; i < bufferLength; i++) {
                ctx.lineTo(i, Math.sin(dataArray[i] / 255 * 2 * Math.PI) * canvas.height / 2 + canvas.height / 2);
            }
            ctx.stroke();
        }
        function drawVIZ10() {
            ctx.fillStyle = "rgba(0,0,0,0.2)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < bufferLength; i += 3) {
                const length = dataArray[i];
                ctx.fillStyle = `hsl(${length}, 100%, 50%)`;
                ctx.fillRect(Math.random() * canvas.width, Math.random() * canvas.height, 5, 5);
            }
        }
    </script>
</body>
</html>
