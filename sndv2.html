/* full HTML document remains unchanged up to the comment: */

        // VIZ1–VIZ10 definitions here (unchanged from prior version)
        // You can reinsert the previous drawVIZ1 to drawVIZ10 functions here

        // Utility: Frequency band labels
        const BAND_LABELS = [
            "20-100Hz", "100-300Hz", "300-800Hz", "800Hz-1.5kHz", "1.5kHz-3kHz",
            "3kHz-6kHz", "6kHz-8kHz", "8kHz-10kHz", "10kHz-12kHz", "12kHz-20kHz"
        ];

        // Add Expand/Collapse All Buttons
        const tableControls = document.createElement('div');
        tableControls.innerHTML = `
            <button onclick="expandAll()">Expand All</button>
            <button onclick="collapseAll()">Collapse All</button>
        `;
        madTable.parentNode.insertBefore(tableControls, madTable);

        function expandAll() {
            document.querySelectorAll('#madTable details').forEach(d => d.open = true);
        }
        function collapseAll() {
            document.querySelectorAll('#madTable details').forEach(d => d.open = false);
        }

        function renderTable() {
            madTable.innerHTML = '';
            for (const day in MAD) {
                const dayEl = document.createElement('details');
                const daySum = document.createElement('summary');
                daySum.textContent = `Date: ${day}`;
                dayEl.appendChild(daySum);

                for (const hour in MAD[day]) {
                    const hourEl = document.createElement('details');
                    const hourSum = document.createElement('summary');
                    hourSum.textContent = `Hour: ${hour}`;
                    hourEl.appendChild(hourSum);

                    for (const minute in MAD[day][hour]) {
                        const minEl = document.createElement('details');
                        const minSum = document.createElement('summary');

                        const entries = Object.values(MAD[day][hour][minute]);
                        const bandCount = entries.length;
                        const aggregates = new Array(10).fill(0);
                        entries.forEach(row => row.forEach((val, i) => aggregates[i] += val));

                        const avg = aggregates.map(t => Math.round(t / bandCount));
                        const min = aggregates.map((_, i) => Math.min(...entries.map(row => row[i])));
                        const max = aggregates.map((_, i) => Math.max(...entries.map(row => row[i])));

                        minSum.textContent = `Minute: ${minute} → Avg: [${avg.join(', ')}]`;
                        minEl.appendChild(minSum);

                        const stats = document.createElement('p');
                        stats.textContent = `Min: [${min.join(', ')}], Max: [${max.join(', ')}]`;
                        minEl.appendChild(stats);

                        for (const sec in MAD[day][hour][minute]) {
                            const secP = document.createElement('p');
                            const values = MAD[day][hour][minute][sec];
                            const labeled = values.map((v, i) => `${BAND_LABELS[i]}: ${v}`);
                            secP.textContent = `Second: ${sec} → [${labeled.join(', ')}]`;
                            minEl.appendChild(secP);
                        }
                        hourEl.appendChild(minEl);
                    }
                    dayEl.appendChild(hourEl);
                }
                madTable.appendChild(dayEl);
            }
        }

        // Visualization logic continues as before

        function drawVIZ1() {
            const barWidth = (canvas.width / bufferLength) * 2.5;
            let barHeight;
            let x = 0;
            for (let i = 0; i < bufferLength; i++) {
                barHeight = dataArray[i] / 2;
                ctx.fillStyle = `rgb(${barHeight + 100}, 50, 50)`;
                ctx.fillRect(x, canvas.height - barHeight / 2, barWidth, barHeight / 2);
                x += barWidth + 1;
            }
        }
        function drawVIZ2() {
            ctx.beginPath();
            for (let i = 0; i < bufferLength; i++) {
                const value = dataArray[i];
                ctx.lineTo(i * canvas.width / bufferLength, canvas.height - value);
            }
            ctx.strokeStyle = 'cyan';
            ctx.stroke();
        }
        function drawVIZ3() {
            for (let i = 0; i < bufferLength; i++) {
                ctx.beginPath();
                const radius = dataArray[i] / 5;
                ctx.arc(canvas.width / 2, canvas.height / 2, radius, 0, 2 * Math.PI);
                ctx.strokeStyle = `hsl(${i * 3.6}, 100%, 50%)`;
                ctx.stroke();
            }
        }
        function drawVIZ4() {
            for (let i = 0; i < bufferLength; i++) {
                const y = Math.random() * canvas.height;
                ctx.fillStyle = `rgba(255, ${dataArray[i]}, ${dataArray[bufferLength - i]}, 0.5)`;
                ctx.fillRect(i * 2, y, 2, 10);
            }
        }
        function drawVIZ5() {
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < bufferLength; i += 4) {
                const angle = (i / bufferLength) * 2 * Math.PI;
                const radius = dataArray[i];
                const x = canvas.width / 2 + radius * Math.cos(angle);
                const y = canvas.height / 2 + radius * Math.sin(angle);
                ctx.fillStyle = `hsl(${angle * 180 / Math.PI}, 100%, 50%)`;
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, 2 * Math.PI);
                ctx.fill();
            }
        }
        function drawVIZ6() {
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
            gradient.addColorStop(0, "red");
            gradient.addColorStop(1, "blue");
            ctx.fillStyle = gradient;
            for (let i = 0; i < bufferLength; i++) {
                ctx.fillRect(i * 2, canvas.height - dataArray[i], 2, dataArray[i]);
            }
        }
        function drawVIZ7() {
            ctx.font = "14px monospace";
            ctx.fillStyle = "lime";
            for (let i = 0; i < 20; i++) {
                ctx.fillText(dataArray[i], 10, 20 * (i + 1));
            }
        }
        function drawVIZ8() {
            const imgData = ctx.createImageData(canvas.width, canvas.height);
            for (let i = 0; i < imgData.data.length; i += 4) {
                imgData.data[i] = dataArray[(i / 4) % bufferLength]; // R
                imgData.data[i + 1] = 0; // G
                imgData.data[i + 2] = 255 - dataArray[(i / 4) % bufferLength]; // B
                imgData.data[i + 3] = 255;
            }
            ctx.putImageData(imgData, 0, 0);
        }
        function drawVIZ9() {
            ctx.strokeStyle = "white";
            ctx.beginPath();
            for (let i = 0; i < bufferLength; i++) {
                ctx.lineTo(i, Math.sin(dataArray[i] / 255 * 2 * Math.PI) * canvas.height / 2 + canvas.height / 2);
            }
            ctx.stroke();
        }
        function drawVIZ10() {
            ctx.fillStyle = "rgba(0,0,0,0.2)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < bufferLength; i += 3) {
                const length = dataArray[i];
                ctx.fillStyle = `hsl(${length}, 100%, 50%)`;
                ctx.fillRect(Math.random() * canvas.width, Math.random() * canvas.height, 5, 5);
            }
        }
    </script>
</body>
</html>
