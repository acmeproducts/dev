<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Final Working Visualizer</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: black;
      color: white;
      font-family: sans-serif;
    }
    #togglePanel {
      position: absolute;
      top: 0;
      left: 0;
      padding: 5px 10px;
      background: #333;
      cursor: pointer;
      z-index: 9999;
    }
    #panel {
      position: absolute;
      top: 30px;
      left: 0;
      background: rgba(0, 0, 0, 0.8);
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 9998;
    }
    label, select, input[type=file] {
      font-size: 14px;
      width: 200px;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
    }
  </style>
</head>
<body>
<div id="togglePanel">Toggle Panel</div>
<div id="panel">
  <label>Mode:
    <select id="mode">
      <option value="1">Static</option>
      <option value="2">Wave</option>
      <option value="3">Ripple (Touch + Tilt)</option>
    </select>
  </label>
  <label>Upload:
    <input type="file" id="upload" accept="image/*">
  </label>
</div>
<canvas id="canvas"></canvas>
<script>
(() => {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const panel = document.getElementById('panel');
  const toggleBtn = document.getElementById('togglePanel');
  const modeSel = document.getElementById('mode');
  const upload = document.getElementById('upload');let width = canvas.width = window.innerWidth; let height = canvas.height = window.innerHeight; let image = null; let imageData = null; let ripple1, ripple2, rippleOut; let phase = 0; const tilt = { gamma: 0, beta: 0 };

window.addEventListener('resize', () => { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; });

toggleBtn.onclick = () => { panel.style.display = panel.style.display === 'none' ? 'flex' : 'none'; };

upload.onchange = e => { const file = e.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = () => loadImage(reader.result); reader.readAsDataURL(file); };

function loadImage(src) { const img = new Image(); img.onload = () => { image = img; ctx.drawImage(img, 0, 0, width, height); imageData = ctx.getImageData(0, 0, width, height); ripple1 = new Float32Array(width * height); ripple2 = new Float32Array(width * height); rippleOut = ctx.createImageData(width, height); }; img.src = src; }

canvas.addEventListener('pointerdown', e => disturb(e.offsetX, e.offsetY)); window.addEventListener('deviceorientation', e => { tilt.gamma = e.gamma; tilt.beta = e.beta; });

function disturb(x, y) { const i = (Math.floor(y) * width + Math.floor(x)); if (i >= 0 && i < ripple1.length) ripple1[i] = 255; }

function drawStatic() { ctx.clearRect(0, 0, width, height); ctx.drawImage(image, 0, 0, width, height); }

function drawWave() { phase += 0.1; for (let y = 0; y < height; y++) { const offset = Math.sin(y / 40 + phase) * 15; ctx.drawImage(image, 0, y, width, 1, offset, y, width, 1); } }

function drawRipple() { const src = imageData.data; const out = rippleOut.data; for (let y = 1; y < height - 1; y++) { for (let x = 1; x < width - 1; x++) { const i = y * width + x; const val = ( ripple1[i - 1] + ripple1[i + 1] + ripple1[i - width] + ripple1[i + width] ) / 2 - ripple2[i]; ripple2[i] = val * 0.99;

const dx = ripple2[i] - ripple2[i - 1];
    const dy = ripple2[i] - ripple2[i - width];
    const sx = Math.min(width - 1, Math.max(0, x + dx * 0.5));
    const sy = Math.min(height - 1, Math.max(0, y + dy * 0.5));
    const si = (Math.floor(sy) * width + Math.floor(sx)) * 4;
    const di = i * 4;
    out[di] = src[si];
    out[di + 1] = src[si + 1];
    out[di + 2] = src[si + 2];
    out[di + 3] = 255;
  }
}
[ripple1, ripple2] = [ripple2, ripple1];
ctx.putImageData(rippleOut, 0, 0);

if (tilt.gamma > 15) disturb(width - 10, height / 2);
if (tilt.gamma < -15) disturb(10, height / 2);
if (tilt.beta > 15) disturb(width / 2, height - 10);
if (tilt.beta < -15) disturb(width / 2, 10);

}

function tick() { if (!image) return requestAnimationFrame(tick); const mode = modeSel.value; if (mode === '1') drawStatic(); else if (mode === '2') drawWave(); else if (mode === '3') drawRipple(); requestAnimationFrame(tick); }

requestAnimationFrame(tick); })(); </script>

</body>
</html>
